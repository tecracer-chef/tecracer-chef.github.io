<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Deploying Custom Ohai Plugins | tecRacer Chef</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://tecracer-chef.github.io/2020/10/deploying-custom-ohai-plugins.html><meta http-equiv=content-language content="en-us"><meta property="og:type" content="website"><meta property="og:site_name" content="tecRacer Chef"><meta property="og:title" content="Deploying Custom Ohai Plugins"><meta property="og:url" content="https://tecracer-chef.github.io/2020/10/deploying-custom-ohai-plugins.html"><meta property="og:image" content="https://tecracer-chef.github.io/images/"><meta name=twitter:title content="tecRacer Chef"><meta name=twitter:url content="https://tecracer-chef.github.io/2020/10/deploying-custom-ohai-plugins.html"><meta name=twitter:image content="https://tecracer-chef.github.io/images/"><meta name=twitter:card content><link rel=alternate href=/blog/feed title="Patrick Schaumburg" type=application/rss+xml><link href=https://tecracer-chef.github.io/css/theme.css rel=stylesheet><script src=https://tecracer-chef.github.io/js/jquery.min.js></script>
<script src=https://tecracer-chef.github.io/js/uikit.min.js></script>
<script src=https://tecracer-chef.github.io/js/fa-all.js></script></head><body><div class="uk-container uk-container-center"><div class=tm-header><div class="tm-toolbar uk-clearfix uk-hidden-small"><div class=uk-float-right><div class=uk-panel><ul class=uk-subnav><li><a href=https://github.com/tecracer-chef class="uk-icon-hover uk-icon-small uk-icon-github" target=_blank></a></li><li><a href=https://twitter.com/tecracer class="uk-icon-hover uk-icon-small uk-icon-twitter" target=_blank></a></li><li><a href=https://www.xing.com/companies/tecracergmbh%26co.kg class="uk-icon-hover uk-icon-small uk-icon-xing" target=_blank></a></li><li><a href=https://www.linkedin.com/company/tecracer-group/ class="uk-icon-hover uk-icon-small uk-icon-linkedin" target=_blank></a></li><li><a href=https://www.facebook.com/tecRacer class="uk-icon-hover uk-icon-small uk-icon-facebook" target=_blank></a></li></ul></div></div></div><nav class=uk-navbar><a class=uk-navbar-brand href=/><img class="tm-logo uk-responsive-height uk-hidden-small" src=https://tecracer-chef.github.io/img/logo/logo-tr.png alt>
<img class="tm-logo-small uk-responsive-height uk-visible-small" src=https://tecracer-chef.github.io/img/logo/logo-tr.png alt></a><div class=uk-hidden-small><ul class=uk-navbar-nav><li><a href=/ title>Blog</a></li><li><a href=/authors title>Authors</a></li><li><a href=/github/github-prs.html title>Pull Requests</a></li></ul></div><div class="uk-navbar-flip uk-visible-small"><a href=#offcanvas class=uk-navbar-toggle data-uk-offcanvas></a></div></nav></div><div id=content><main id=tm-content class=tm-content><article class=uk-article><div class="tm-article-featured-image uk-cover-background" style=background-image:url(img/2020/10/arthur-yeti--zoe4nviem4-unsplash.jpg)></div><div class="tm-article-content uk-position-relative"><div class="tm-article-date uk-text-center"><span class=tm-article-date-day>26</span>
<span class=tm-article-date-month>Oct</span></div><h1 class=uk-article-title>Deploying Custom Ohai Plugins</h1><p class=uk-article-meta>Written by
<a target=_self title="Thomas Heinen's Author Profile SINGLE.HTML" href=/authors/thomas-heinen data-original-title="Author's Profile">Thomas Heinen</a></p><div class=uk-margin><p>With the deprecation of the <code>ohai</code> cookbook, there is some confusion on how to deploy custom Ohai plugins.</p><p>This short summary shows, how easy deployments have become.</p><h2 id=user-managed-plugins>User-Managed Plugins</h2><p>Before, new plugins for system discovery were used with the <a href=https://supermarket.chef.io/cookbooks/ohai>Ohai cookbook</a>, which mainly offered the <code>ohai_plugin</code> resource. Commonly, you could see the following code in cookbooks:</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>ohai_plugin <span style=color:#ba2121>&#39;ipaddress&#39;</span> <span style=color:green;font-weight:700>do</span>
</span></span><span style=display:flex><span>  <span style=color:green>name</span> <span style=color:#ba2121>&#39;ipaddress&#39;</span>
</span></span><span style=display:flex><span>  load_single_plugin <span style=color:green>true</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>end</span>
</span></span></code></pre></div><p>This would search your <code>files/ipaddress.rb</code> plugin, deploy it to the custom plugin directory and reload it to get data. Sometimes, you also find a separate resource in old cookbooks which reloads using the Chef built-in <code>ohai</code> resource.</p><p>Many of the outdated Chef tutorials or books will still try to teach you this pattern. But the world moved on&mldr;</p><h2 id=chef-managed-plugins>Chef-Managed Plugins</h2><p>For several years already(!), using custom plugins has been extremely easy: Just move your plugin into the cookbook <code>ohai/</code> directory. That&rsquo;s it! An additional step in the compile phase will take care of moving the file into the correct spot, loading it and querying the data it returns.</p><p>You can remove all that custom plugin installation code and have the same functionality. Of course, any cookbooks depending on the one with the plugin get the correct data as well.</p><h2 id=origins>Origins</h2><p>The feature of having a cookbooks directory for Ohai specifically (<a href=https://github.com/chef-boneyard/chef-rfc/blob/master/rfc059-ohai-cookbook-segment.md>RFC 59</a>) has been present since Chef Infra Client 13.0, but was <a href=https://github.com/chef/chef/pull/6017#issuecomment-291943551>not publicly documented until the Chef Server could handle a newer API version</a>. With Chef Infra Server 12.18.14, this support arrived - roughly around the release of Chef Infra v14.6.26.</p><p>The exact time of documenting the feature is hard to pinpoint, as the Chef Docs page changed to a Hugo-based blog in early 2020. It has been on the page on <a href=https://docs.chef.io/cookbooks/>cookbook structure</a> at least since then.</p></div></div></article><article class=uk-article><div class=container><section class=author-box itemprop=author itemscope itemtype=https://schema.org/Person><div class="media author-box"><div class=media-figure><img alt="Author Image" src=/authors/theinen.png class="avatar avatar-100 photo" height=125 width=125></div><div class=media-body><h2><a href=/authors/thomas-heinen>Thomas Heinen</a></h2><p>Thomas is a Cloud Consultant and Trainer at tecRacer Consulting with a focus on Chef, AWS, DevOps and Security.</p><div class=author-icons><a target=_self class=author-website title="Thomas Heinen's Author Profile" href=/authors/thomas-heinen data-original-title="Author's Profile"><i class="fas fa-id-card"></i></a>
<a target=_new class=author-xing title="Thomas Heinen on Xing" href=https://xing.com/profile/Thomas_Heinen4 data-original-title=Xing><i class="fab fa-xing"></i></a>
<a target=_new class=author-linkedin title="Thomas Heinen on LinkedIn" href=https://linkedin.com/in/thomas-heinen data-original-title=LinkdIn><i class="fab fa-linkedin"></i></a>
<a target=_new class=author-github title="Thomas Heinen on GitHub" href=https://github.com/tecracer-theinen data-original-title=Github><i class="fab fa-github"></i></a></div></div></div></section></div></article></main></div><div id=tm-footer class=tm-footer><div id=tm-footer class="tm-footer tm-footer-margin-top"><div class="uk-panel uk-panel-space uk-text-center"><p>Copyright Â© 2018-today by <a href=https://chef.tecracer.de/ target=_blank>tecRacer</a></p></div></div></div><div id=offcanvas class=uk-offcanvas aria-hidden=true><div class="uk-offcanvas-bar uk-offcanvas-bar-flip"><div class="uk-panel uk-text-center"><a href=https://tecracer-chef.github.io/></a>
<img src=https://tecracer-chef.github.io/img/logo/logo-tr.png alt></a></div><ul class="uk-nav uk-nav-offcanvas"><li><a href=/ title>Blog</a></li><li><a href=/authors title>Authors</a></li><li><a href=/github/github-prs.html title>Pull Requests</a></li></ul></div></div></div></body></html>